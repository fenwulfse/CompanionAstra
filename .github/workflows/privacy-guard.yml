name: Privacy Guard

on:
  pull_request:
  push:
    branches:
      - main
      - astra/integration

jobs:
  scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Scan for local machine path leaks
        shell: bash
        run: |
          set -euo pipefail
          patterns='(E:\\|D:\\|C:\\Users\\)'
          if git grep -n -I -E "$patterns" -- . ':(exclude).git' ':(exclude).github/workflows/privacy-guard.yml' ':(exclude)*.png' ':(exclude)*.jpg' ':(exclude)*.jpeg' ':(exclude)*.gif' ':(exclude)*.bmp'; then
            echo "Path or identity leak detected. Replace with placeholders before merge."
            exit 1
          fi
          echo "Privacy scan clean."
